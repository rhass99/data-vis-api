{"version":3,"sources":["../../../src/api/elastic/es.js"],"names":["inputfile","esClient","elasticsearch","Client","host","log","ping","requestTimeout","err","console","trace","makebulk","list","callback","allUsers","JSON","parse","fs","readFileSync","bulk","forEach","user","push","index","_index","_type","_id","indexOf","user_email","email","drugname","info","indexAll","madebulk","maxRetries","type","body","resp","status","items","res"],"mappings":";;AAAA;;;;AACA;;;;;;AAEA,MAAMA,YAAY,kBAAlB;;AAEA,MAAMC,WAAWC,wBAAcC,MAAd,CAAqB;AACpCC,QAAM,gBAD8B;AAEpCC,OAAK;AAF+B,CAArB,CAAjB;;AAKAJ,SAASK,IAAT,CAAc;AACZC,kBAAgB;AADJ,CAAd,EAEIC,GAAD,IAAS;AACV,MAAIA,GAAJ,EAAS;AACPC,YAAQC,KAAR,CAAc,aAAd;AACD,GAFD,MAEO;AACLD,YAAQJ,GAAR,CAAY,gBAAZ;AACD;AACF,CARD;;AAUA,MAAMM,WAAW,CAACC,IAAD,EAAOC,QAAP,KAAoB;AACnC;AACA,QAAMC,WAAWC,KAAKC,KAAL,CAAWC,aAAGC,YAAH,CAAgBN,IAAhB,EAAsB,MAAtB,CAAX,CAAjB;AACA,QAAMO,OAAO,EAAb;;AAEAL,WAASM,OAAT,CAAkBC,IAAD,IAAU;AACzBF,SAAKG,IAAL,CAAU,EAAEC,OAAO,EAAEC,QAAQ,OAAV,EAAmBC,OAAO,MAA1B,EAAkCC,KAAKZ,SAASa,OAAT,CAAiBN,IAAjB,CAAvC,EAAT,EAAV,EACE;AACEO,kBAAYP,KAAKQ,KADnB;AAEEC,gBAAUT,KAAKS,QAFjB;AAGEC,YAAMV,KAAKU;AAHb,KADF;AAMD,GAPD;AAQAlB,WAASM,IAAT;AACD,CAdD;;AAgBA,MAAMa,WAAW,CAACC,QAAD,EAAWpB,QAAX,KAAwB;AACvCZ,WAASkB,IAAT,CAAc;AACZe,gBAAY,CADA;AAEZX,WAAO,OAFK;AAGZY,UAAM,MAHM;AAIZC,UAAMH;AAJM,GAAd,EAKG,CAACzB,GAAD,EAAM6B,IAAN,EAAYC,MAAZ,KAAuB;AACxB,QAAI9B,GAAJ,EAAS;AACPC,cAAQJ,GAAR,CAAYG,GAAZ;AACD,KAFD,MAEO;AACLK,eAASwB,KAAKE,KAAd;AACD;AACF,GAXD;AAYD,CAbD;;AAgBA5B,SAASX,SAAT,EAAqBwC,GAAD,IAAS;AAC3B/B,UAAQJ,GAAR,CAAY,uBAAZ;AACA2B,WAASQ,GAAT,EAAeA,GAAD,IAAS;AACrB/B,YAAQJ,GAAR,CAAYmC,GAAZ;AACD,GAFD;AAGD,CALD","file":"es.js","sourcesContent":["import elasticsearch from 'elasticsearch';\nimport fs from 'fs';\n\nconst inputfile = './indexKeys.json';\n\nconst esClient = elasticsearch.Client({\n  host: 'localhost:9200',\n  log: 'trace',\n});\n\nesClient.ping({\n  requestTimeout: 1000,\n}, (err) => {\n  if (err) {\n    console.trace('els is down');\n  } else {\n    console.log('els is working');\n  }\n});\n\nconst makebulk = (list, callback) => {\n  // How to read JSON from file to JSON object\n  const allUsers = JSON.parse(fs.readFileSync(list, 'utf8'));\n  const bulk = [];\n\n  allUsers.forEach((user) => {\n    bulk.push({ index: { _index: 'users', _type: 'user', _id: allUsers.indexOf(user) } },\n      {\n        user_email: user.email,\n        drugname: user.drugname,\n        info: user.info,\n      });\n  });\n  callback(bulk);\n};\n\nconst indexAll = (madebulk, callback) => {\n  esClient.bulk({\n    maxRetries: 5,\n    index: 'users',\n    type: 'user',\n    body: madebulk,\n  }, (err, resp, status) => {\n    if (err) {\n      console.log(err);\n    } else {\n      callback(resp.items);\n    }\n  });\n};\n\n\nmakebulk(inputfile, (res) => {\n  console.log('Bulk Content prepared');\n  indexAll(res, (res) => {\n    console.log(res);\n  });\n});"]}